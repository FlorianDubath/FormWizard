<html>
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<link rel="stylesheet" type="text/css" href="resources/FormWizard.css" />
	
    <title>FormWizard's test page</title>
</head>
<body style="background-color:blue;">
	<div id="container" style="background-color:white; margin:20px;border:solid 1px black;height:calc(100% - 40px);"></div>
</body >

 <script type="text/javascript">
  	var model = {
  "formWizardObject": {
    "title": "Example 1",
    "version": "0.0.1",
    "creation_date": "2019-12-25",
    "section": [
      {
        "title": "Identification",
        "description":"Identity of the person",
        "field": [
          {
            "label": "Name",
            "type": "string",
            "mandatory": "False"
          },
          {
            "label": "Last Name",
            "type": "String",
            "mandatory": "True"
          },
          {
            "label": "Birth Date",
            "type": "date",
            "mandatory": "True"
          }
        ]
      },
      {
        "title": "Address",
        "description":"Where the person lives",
        "field": [
          {
            "label": "Street and Number",
            "type": "string",
            "mandatory": "True"
          },
          {
            "label": "ZIP Code",
            "type": "string",
            "value":"1200",
            "mandatory": "True"
          },
          {
            "label": "Country",
            "type": "country",
            "mandatory": "True"
          }
        ]
      }
    ]
  }
};


class BcButton {
	constructor(form_wizard, index) {
		this.form_wizard = form_wizard;
		this.index = index;
	}
	
	getDom() {
		var btn = document.createElement("div");  
  	 	btn.appendChild(document.createTextNode((this.index+1)));
  	    btn.id="btn_s"+this.index;
  	 	btn.classList.add("bc_btn");
  	 	btn.form_wizard = this.form_wizard;
  	 	btn.index = this.index;
  	 	
 		if (btn.addEventListener) {
        	btn.addEventListener('click', function() {
        	    this.form_wizard.showSection(this.index);
        	}, false);
    	} else if (btn.attachEvent) {
        	btn.attachEvent('onclick', function() {
            	this.form_wizard.showSection(this.index);
        	});
    	}
    	return btn;
	}
}

const getMandatorySymbol = function(field) {
	return (field.mandatory.toLowerCase()=="true")? " *":"";
	
}

const getDomField = function(section_index, field_index, field) {
  	 	var div_field = document.createElement("div");

  	 	div_field.id="f_s"+section_index+"_f"+field_index;
  	 	div_field.classList.add("fld");
  	 	var fld_lbl =  document.createElement("div");
  	 	fld_lbl.appendChild(document.createTextNode(field.label + getMandatorySymbol(field)));
  	 	fld_lbl.classList.add("fld_lbl");
  	 	fld_lbl.id="fl_s"+section_index+"_f"+field_index;
  	 	div_field.appendChild(fld_lbl);
  	 	var fld_input = document.createElement("input");
  	 	fld_input.id = "fi_s"+section_index+"_f"+field_index;
  	 	fld_input.classList.add("fld_input");
  	 	switch (field.type.toLowerCase()) {
  	 		case 'string':
  	 			fld_input.type="text";
  	 			if (field.value !== undefined) {
  	 				fld_input.value = field.value;
  	 			}
  	 			fld_input.classList.add("fld_txt");
  	 			break;
  	 		case 'date':
  	 			fld_input.type="date";  	 			
  	 			if (field.value !== undefined) {
  	 				fld_input.value = field.value;
  	 			}
  	 			fld_input.classList.add("fld_date");
  	 			break;
  	 		case 'country':
  	 			fld_input.classList.add("fld_drop");
  	 			// todo dropdown
  	 			break;
  	 	}
  	 	

  	 	
  	 	
  	 	div_field.appendChild(fld_input);
  	 	return div_field;
  	 	
}

class FormWizard {
  constructor(container_id, model) {
    this.container_id = container_id;
    this.model = model;
    this.initialized = false;
    
    this.initialize();
    this.showSection(0);
    
  }
  
  initialize() {
  	 if (this.initialized) {
  	 	return;
  	 }
  	 this.current_section = -1;
  	 
  	 var ext_cont = document.getElementById(this.container_id); 
  	 this.container = document.createElement("div");
  	 this.container.classList.add("inner_cont");
	 ext_cont.appendChild(this.container);
	 
  	 // Create the bread crumb
  	 var header = document.createElement("div");
  	 header.id="header";
  	 header.classList.add("header");
  	 
  	 for (var index=0; index < this.model["formWizardObject"].section.length; index++) {
  	 	 var btn = new BcButton(this, index);
  	 	 header.appendChild(btn.getDom());
  	 }
  	 
  	 var btn_close = document.createElement("div");  
  	 btn_close.classList.add("bc_btn_close");
  	 btn_close.form_wizard = this;
  	 btn_close.appendChild(document.createTextNode("X"));
  	 if (btn_close.addEventListener) {
        	btn_close.addEventListener('click', function() {
        	    this.form_wizard.close();
        	}, false);
    	} else if (btn_close.attachEvent) {
        	btn_close.attachEvent('onclick', function() {
            	this.form_wizard.close();
        	});
    	}
  	 header.appendChild(btn_close);
  	 this.container.appendChild(header);
  	 
  	 // add the sections
  	 var sect_cont_div = document.createElement("div");
  	 sect_cont_div.classList.add("sect_cont");
  	 var section_index;
  	 for (section_index in this.model["formWizardObject"].section) {
  	    var section = this.model["formWizardObject"].section[section_index];
  	 	var sect_div = document.createElement("div");
  		sect_div.classList.add("sect_hidden");
  	 	sect_div.id="sec_"+section_index;
  	 	sect_div.classList.add("sect");
  	 	var sect_title = document.createElement("div");
  	 	sect_title.appendChild(document.createTextNode(section.title));
  	 	sect_title.classList.add("sect_title");
  	 	sect_div.appendChild(sect_title);
  	 	var sect_descr = document.createElement("div");
  	 	sect_descr.appendChild(document.createTextNode(section.description));
  	 	sect_descr.classList.add("sect_descr");
  	 	sect_div.appendChild(sect_descr);
  
  	 	var field_index;
  	 	for (field_index in section.field) {
  	 		var field = section.field[field_index];
  	 		sect_div.appendChild(getDomField(section_index, field_index, field));
  	 	}
  	 	
  	 	
  	    sect_cont_div.appendChild(sect_div);
  	 }
  	
  	 var footer_div = document.createElement("div");
  	 footer_div.classList.add("footer");
  	 var btn_next = document.createElement("div");  
  	 btn_next.appendChild(document.createTextNode("Next"));
  	 btn_next.id="btn_next";
  	 btn_next.classList.add("btn_next");
  	 btn_next.classList.add("btn_hidden");
  	 btn_next.form_wizard = this;
  	 if (btn_next.addEventListener) {
        	btn_next.addEventListener('click', function() {
        	    this.form_wizard.nextSection();
        	}, false);
     } else if (btn_next.attachEvent) {
        	btn_next.attachEvent('onclick', function() {
            	this.form_wizard.nextSection();
        	});
     }	
  	 footer_div.appendChild(btn_next);
  	 var btn_end = document.createElement("div");  
  	 btn_end.appendChild(document.createTextNode("End"));
  	 btn_end.id="btn_end";
  	 btn_end.classList.add("btn_end");
  	 btn_end.classList.add("btn_hidden");
  	 btn_end.form_wizard = this;
  	 if (btn_end.addEventListener) {
        	btn_end.addEventListener('click', function() {
        	    this.form_wizard.completed();
        	}, false);
     } else if (btn_end.attachEvent) {
        	btn_end.attachEvent('onclick', function() {
            	this.form_wizard.completed();
        	});
     }	
  	 footer_div.appendChild(btn_end);
	 sect_cont_div.appendChild(footer_div);
  	 this.container.appendChild(sect_cont_div);
  	 this.initialized=true;
  }
  
  isSectionValid(section_index) {
    var valid=true;
    var section = this.model["formWizardObject"].section[section_index];
    var field_index;
  	for (field_index in section.field) {
  		var field = section.field[field_index];
  		if (field.mandatory.toLowerCase()=="true") {
  			const input = document.getElementById("fi_s"+section_index+"_f"+field_index);
  			const fld_valid =  input.value!==undefined && input.value!="";
  			var lbl = document.getElementById("fl_s"+section_index+"_f"+field_index);
  			if (fld_valid) {
  				lbl.classList.remove("lbl_invalid");
  			} else {
  				lbl.classList.add("lbl_invalid");
  			}
  			valid &= fld_valid;
  		}
  	}
	return valid;  
  }
  
  nextSection() {
  	this.showSection(this.current_section+1);
  }
  
 
  
  showSection(section_index){
    if (this.current_section>=0) {
      // when invalid ask for completion
       const valid = this.isSectionValid(this.current_section);
       if (!valid && this.current_section < section_index) {
       	 if (confirm("This section has some missing or invalid fields. Do you want to complete them now?")){
       	 	return;
       	 }
       }
  		document.getElementById("sec_"+this.current_section).classList.add("sect_hidden");
  	}
  	
  	if (section_index==this.model["formWizardObject"].section.length-1) {
  		document.getElementById("btn_next").classList.add("btn_hidden");
  		document.getElementById("btn_end").classList.remove("btn_hidden");
  	} else{
  		document.getElementById("btn_next").classList.remove("btn_hidden");
  		document.getElementById("btn_end").classList.add("btn_hidden");
	}  	
  	
  	document.getElementById("sec_"+section_index).classList.remove("sect_hidden");

  	this.current_section = section_index;
  	for (var sect_index =0;sect_index<  this.model["formWizardObject"].section.length; sect_index++) {
  		var btn = document.getElementById("btn_s"+sect_index);
  		if (sect_index < this.current_section) {
  			const valid = this.isSectionValid(sect_index);
  			btn.classList.remove("bc_btn_not_view");
  			btn.classList.remove("bc_btn_current");
  			btn.classList.remove("bc_btn_invalid");
  			if (!valid) {
  				btn.classList.add("bc_btn_invalid");
  			}
  		} else if 	(sect_index == this.current_section) {
  			btn.classList.remove("bc_btn_not_view");
  			btn.classList.add("bc_btn_current");
  			btn.classList.remove("bc_btn_invalid");
  		} else {
  			btn.classList.add("bc_btn_not_view");
  			btn.classList.remove("bc_btn_current");
  			btn.classList.remove("bc_btn_invalid");
  		}	
  	}
  } 
  
  readValues() {
  	for (var section_index =0;sect_index<  this.model["formWizardObject"].section.length; sect_index++) {
  		var section = this.model["formWizardObject"].section[section_index];
    	var field_index;
  		for (field_index in section.field) {
  			section.field[field_index].value = document.getElementById("fi_s"+section_index+"_f"+field_index).value;
  		}
  	}
  }
  
   close(){
  	alert("close");
  } 
  
  completed(){
  	var valid =true;
    for (var section_index in this.model["formWizardObject"].section) {
    	valid &= this.isSectionValid(section_index);
    }
  	if (!valid) {
  		alert("At least one section has some missing or invalid fields. You need to complete them.")
  	} else {
  		this.endAction();
  	}
  }
  
  endAction() {
    this.sreadValues();
  	alert("end");
  }
}





var form_wizard = new FormWizard("container", model);
  
</script>

</html>
